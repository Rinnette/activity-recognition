---
title: "Quantifying how well a weight lifting exercise is performed"
author: "Rinnette N. Ramdhanie"
date: "13 January 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loadLibs, warning = FALSE, message = FALSE, echo = FALSE}
        library(caret)
        library(corrplot)
```

## Overview

What is the question that is going to be answered.


## Loading the data

The data came from ...wherever... located at ...link...

```{r loaddata}
        training <- read.csv("../pml-training.csv")
        testing <- read.csv("../pml-testing.csv")
```

## Exploratory analysis
```{r}
        corrMatrix <- cor(train[, -53])
        corrplot(corrMatrix, method = "color", type = "lower", order = "AOE")

```
Therefore preprocess, method pca as there are some highly correlated variables. USed to reduce the number if variables to reduce overfitting and make it computationally simpler.


## Processing the Data

```{r}
        # Remove first 7 columns
        train <- training[, -c(1:7)]
        test <- testing[, -c(1:7)]
        
        # Remove columns with near zero variance
        train <- train[ , -nearZeroVar(train)]
        test <- test[ , -nearZeroVar(test)]
        
        # Remove columns with more than 90% NA's
        train <- train[ , which(colMeans(is.na(train)) < 0.9)]
        test <- test[ , which(colMeans(is.na(test)) < 0.9)]
```

## Partition the training dataset

```{r dataPartition}
        inTrain <- createDataPartition(train$classe, p = 0.70, list = FALSE)
        trainset <- train[inTrain, ]
        validset <- train[-inTrain, ]
```

## Fit Models
Apply PCA to trainset and validset

```{r preProcSets}
        preProctrain <- preProcess(trainset[,-53], method = "pca")
        trainPP <- predict(preProctrain, trainset)
        preProcvalid <- preProcess(validset[,-53], method = "pca")
        validPP <- predict(preProcvalid, validset)
```

```{r fitModelPP}
        traincontrol <- trainControl(method = "cv", number = 5)

        set.seed(999)
        RFtrainPP <- train(classe ~ ., data = trainPP, method = "rf", 
                        trControl = traincontrol) #.971
        RFtrainPP
        
        set.seed(999)
        GBMtrainPP <- train(classe ~ ., data = trainPP, method = "gbm", 
                       trControl = traincontrol) #.814
        GBMtrainPP
        
        set.seed(999)
        CTtrainPP <- train(classe ~ ., data = trainPP, method = "rpart", 
                        trControl = traincontrol) #.425
        CTtrainPP
```

SUmmarize accuracies in table and select the highest. Apply to validPP dataset.
Predict new values using valid preprocessed dataset ie. validPP.

```{r predvalidPP}
        predRF <- predict(RFtrainPP,validPP)
        confusionMatrix(predRF, validPP$classe)
        #validPP$predRight <- pred==validPP$classe
        #table(pred, validPP$classe)

```

Decision made to use data that was not PCAed. since information was lost

```{r fitModels}
        traincontrol <- trainControl(method = "cv", number = 5)

        set.seed(999)
        RFtrain <- train(classe ~ ., data = trainset, method = "rf", 
                        trControl = traincontrol) #.991
        RFtrain
        
        set.seed(999)
        GBMtrain <- train(classe ~ ., data = trainset, method = "gbm", 
                       trControl = traincontrol) #.
        GBMtrain
        
        set.seed(999)
        CTtrain <- train(classe ~ ., data = trainset, method = "rpart", 
                        trControl = traincontrol) #
        CTtrain

```
Compare accuracies and errors to previous models in same table.

Select model and run on validset data.  Compare with previous values.

```{r predvalid}
        predvalidRF <- predict(RFtrain, validset)
        confusionMatrix(predvalidRF, validset$classe) #0.9931
        #validPP$predRight <- pred==validPP$classe
        #table(pred, validPP$classe)

```

Use model on test data.
```{r predtest}
        predict(RFtrain, test)
```
